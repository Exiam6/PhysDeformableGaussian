import os
import json

# c2w and K matrices
camera_data =[
    {
        "camera": "camera_000",
        "c2w": [
            [
                -0.5962580442428589,
                -0.22521395981311798,
                -0.7705550193786621,
                -0.3839739263057709
            ],
            [
                0.05749770253896713,
                0.9453974366188049,
                -0.32080793380737305,
                0.24431917071342468
            ],
            [
                0.8007311820983887,
                -0.23558944463729858,
                -0.5507515072822571,
                0.05064454674720764
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_001",
        "c2w": [
            [
                0.5936836004257202,
                0.8027166128158569,
                0.056442562490701675,
                0.40396201610565186
            ],
            [
                0.054990194737911224,
                0.02950701117515564,
                -0.9980508089065552,
                -0.4388406276702881
            ],
            [
                -0.8028174638748169,
                0.5956302285194397,
                -0.026623714715242386,
                0.5541555881500244
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_002",
        "c2w": [
            [
                0.7789927124977112,
                -0.4832601547241211,
                0.39953720569610596,
                0.7527586221694946
            ],
            [
                -0.15577195584774017,
                0.4680615961551666,
                0.8698582649230957,
                1.2417800426483154
            ],
            [
                -0.6073758602142334,
                -0.7398499846458435,
                0.28933820128440857,
                0.8153300285339355
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_003",
        "c2w": [
            [
                -0.9942378401756287,
                -0.050644829869270325,
                -0.09447847306728363,
                0.29080021381378174
            ],
            [
                -0.07112812250852585,
                0.9710652232170105,
                0.22797617316246033,
                0.7725712060928345
            ],
            [
                0.08019894361495972,
                0.23338261246681213,
                -0.9690720438957214,
                -0.3738537132740021
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_004",
        "c2w": [
            [
                0.7414035797119141,
                -0.663604736328125,
                0.09974697977304459,
                0.4768420159816742
            ],
            [
                -0.1835894137620926,
                -0.05761082097887993,
                0.9813133478164673,
                1.2598974704742432
            ],
            [
                -0.6454576849937439,
                -0.7458617687225342,
                -0.16454367339611053,
                0.4045916199684143
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_005",
        "c2w": [
            [
                0.752159833908081,
                0.23375429213047028,
                -0.6161286234855652,
                -0.2079523354768753
            ],
            [
                0.019590191543102264,
                0.9266273379325867,
                0.37547042965888977,
                0.8664591312408447
            ],
            [
                0.6586894392967224,
                -0.29448387026786804,
                0.6923925876617432,
                1.217947006225586
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_006",
        "c2w": [
            [
                -0.018727928400039673,
                -0.11806167662143707,
                -0.9928296208381653,
                -0.47654446959495544
            ],
            [
                -0.05627167597413063,
                0.991554319858551,
                -0.11684855818748474,
                0.41130301356315613
            ],
            [
                0.9982398152351379,
                0.05367985740303993,
                -0.02521328628063202,
                0.5859023928642273
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_007",
        "c2w": [
            [
                -0.013479511253535748,
                -0.4087909162044525,
                0.9125285148620605,
                1.2496249675750732
            ],
            [
                0.0036390838213264942,
                0.9125853180885315,
                0.4088701009750366,
                0.8740700483322144
            ],
            [
                -0.9999025464057922,
                0.00883213710039854,
                -0.010813579894602299,
                0.5682114362716675
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_008",
        "c2w": [
            [
                0.8471707105636597,
                0.4465780556201935,
                -0.28787124156951904,
                0.1250339150428772
            ],
            [
                0.20326174795627594,
                0.22818662226200104,
                0.952163577079773,
                1.336838722229004
            ],
            [
                0.49090373516082764,
                -0.8651583194732666,
                0.10254078358411789,
                0.6447229981422424
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    },
    {
        "camera": "camera_009",
        "c2w": [
            [
                -0.6181976795196533,
                0.13412638008594513,
                0.7744945287704468,
                1.1569944620132446
            ],
            [
                0.15537288784980774,
                0.9867435693740845,
                -0.04686565697193146,
                0.517645001411438
            ],
            [
                -0.7705134153366089,
                0.09136320650577545,
                -0.6308421492576599,
                -0.013662360608577728
            ],
            [
                0.0,
                0.0,
                0.0,
                1.0
            ]
        ],
        "K": [
            [
                711.1111111111111,
                0,
                256.0
            ],
            [
                0,
                711.1111111111111,
                256.0
            ],
            [
                0,
                0,
                1
            ]
        ]
    }
]
time_mapping = [
    {"000": 0.0},
    {"001": 0.03},
    {"002": 0.06},
    {"003": 0.09},
    {"004": 0.12},
    {"005": 0.15},
    {"006": 0.18},
    {"007": 0.21},
    {"008": 0.24},
    {"009": 0.27},
    {"010": 0.3},
    {"011": 0.32999999999999996},
    {"012": 0.36},
    {"013": 0.39},
    {"014": 0.42},
    {"015": 0.44999999999999996},
    {"016": 0.48},
    {"017": 0.51},
    {"018": 0.54},
    {"019": 0.57},
    {"020": 0.6},
    {"021": 0.63},
    {"022": 0.6599999999999999},
    {"023": 0.69},
    {"024": 0.72},
    {"025": 0.75},
    {"026": 0.78},
    {"027": 0.8099999999999999},
    {"028": 0.84},
    {"029": 0.87},
]

def generate_json(camera_data, time_mapping, base_dir, output_json_path):
    json_data = {"frames": []}

    for camera in camera_data:
        camera_id = camera["camera"]
        c2w = camera["c2w"]

        camera_path = os.path.join(base_dir, camera_id)
        images = sorted([img for img in os.listdir(camera_path) if img.lower().endswith(('.jpg', '.png'))])

        for idx, image_name in enumerate(images):
            time_entry = time_mapping[idx] if idx < len(time_mapping) else {f"{idx:03d}": idx * 0.03}
            time = list(time_entry.values())[0]
            frame_data = {
                "rotation":0.001,
                "file_path": os.path.join(camera_id,  os.path.splitext(image_name)[0]),
                "transform_matrix": c2w,
                "time": time
            }
            json_data["frames"].append(frame_data)

    with open(output_json_path, 'w') as f:
        json.dump(json_data, f, indent=4)
    print(f"JSON file saved to {output_json_path}")


if __name__ == "__main__":
    base_directory = "./data"  
    output_json_file = "transforms_train.json"
    generate_json(camera_data, time_mapping, base_directory, output_json_file)